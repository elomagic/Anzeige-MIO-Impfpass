import { Meta } from "@storybook/addon-docs";

<Meta title="Entwicklung/MIO Parser" />

# Integration des MIOParsers

Die KBV hat in Kombination mit dem MIOViewer auch einen MIOParser entwickelt:
https://github.com/kassenaerztliche-bundesvereinigung/MIOParser
Dieser kann in der React-Lösung für die Visualisierung für MIOs integriert werden.

In dem React-Prototypen ist der MIOParser bereits integriert.
Alle Funktionalitäten für das Lesen und Arbeiten mit den FHIR-Ressourcen (im Rahmen der MIOParser Funktionalitäten) sind im "mioParser" Service in "src/services/mioParser.tsx" gesammelt und werden in den Komponenten nach Bedarf importiert.

Die Nutzungsweise des MIOParsers ist in der README Datei des MIOParser-Repositories dokumentiert.

Teilweise benötigt die Arbeit mit dem MIOParser das Suchen nach spezifischen Typen. Welche Typen verfügbar sind, kann in VSCode gut untersucht werden, indem mit STRG + Klick auf die DatenTypen, z.B.: Vaccination.V1_1_0 geklickt wird.
Anschließend öffnen sich die Dateien der MIOParser Implementierung mit den Typendefinitionen, in welchen man schnell die verfügbaren Typen überblicken oder tiefergehend untersuchen kann.

## Konfiguration des Pfades zu den einzulesenden Daten

Die App Komponente (App.tsx) liest beim Start der React-App einmalig eine Konfigurationsdatei ein (config.json), welche im "public" Ordner liegt.
Diese Konfigurationsdatei enthält den Pfad zu dein einzulesenden Daten. Aktuell wird ein einzelnes Bundle eingelesen, künftig können mehrere Bundles eingelesen werden (beispielsweise alle xml Dateien im Ordner). Hersteller können diese Konfigurationsdatei anpassen, um den Pfad zu einzulesenden Dateien zu ändern, jedoch sollten die Daten im "public" Ordner enthalten sein und der Pfad relativ zum "public" Ordner sein.

## Einlesen der Daten durch den MIOParser

Nachdem die App Komponente (App.tsx) die Konfigurationsdatei eingelesen hat, werden die XML-Daten entsprechend dem in der Konfiguration angegebenen Pfad per fetch() Funktion geladen.
Es wird somit erwartet, dass die Daten auf dem Server der Web-App verfügbar sind.

Anschließend werden nacheinander zunächst das komplette Bundle geladen und durch den MIOParser eingelesen, anschließend wird der Patient extrahiert, gefolgt von den RecordPrime-Einträgen. Damit dies automatisch beim Start der Komponente geschieht und das Laden der Daten die Komponente zum erneuten Rendern bringt (visuelles Neuladen, damit die Daten korrekt in die Anzeige eingefügt werden), wird dies im "useEffect" Hook der React Komponente ausgeführt. Die Daten werden mit "useState" ReactHooks im State der Komponente gespeichert. Mehr zu ReactHooks hier: https://reactjs.org/docs/hooks-intro.html

<img src="./useEffect.PNG" alt="useEffect für Laden der Daten in React" />

Ähnlich ist die Verwendung der Patientendaten in der Vaccination-Header Komponente:

<img src="./header.PNG" alt="Header image für MIOParser" />
